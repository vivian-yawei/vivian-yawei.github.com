<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="author" content="智能社 - zhinengshe.com" />
<meta name="copyright" content="智能社 - zhinengshe.com" />
<title>webqq聊天室</title>
<style>
*{ margin:0; padding:0; list-style:none; font-family: "微软雅黑","张海山锐线体简"}
body{ text-align:center;}
#login_box{width:300px; padding:10px; border:1px solid #000; margin:100px auto;}
</style>
<script src="jsonp.js"></script>
<script src="cookie.js"></script>
<script>
window.onload=function(){
	var oUser=document.getElementById('user');
	var oPass=document.getElementById('pass');
	var oLogin=document.getElementById('login');
	var oReg=document.getElementById('reg');
	var URL='http://zhinengshe.com/exercise/im/api.php';
	//1注册
	oReg.onclick=function(){
		//?a=reg&user=用户名&pass=密码&face=头像ID&cb=xxx
		jsonp({url:URL,
			data:{
				a:'reg',
				user:oUser.value,
				pass:oPass.value,
				face:Math.random()*8+1
				},
			success:function(json){
				//{err: 0, msg: "注册成功"}
				if(json.err==0){
					alert(json.msg);
				}else{
					alert(json.msg);
				}
			}
		});
	};
	//2/登录
	oLogin.onclick=function(){
		//?a=lgn&user=用户名&pass=密码&cb=xxx
		jsonp({
			url:URL,
			data:{a:'lgn',
				  user:oUser.value,
				  pass:oPass.value
				  },
			success:function(json){
				//{err: 0, msg: "登录成功", face: 头像ID, login_time: 上次登录时间, token: "token"}
				if(json.err==0){
					alert(json.msg);
					location.href='chart.html';
					setCookie('user',oUser.value);
					setCookie('token',json.token);
				}else{
					alert(json.msg);
				}
			}
		});
	};
};
</script>
</head>

<body>
<div id="login_box">
	用户名：<input id="user" type="text"/> <br /><br />
	密&nbsp;码:<input id="pass" type="text"/><br /><br />
	<input id="login" type="button" value="登陆" />
	<input id="reg" type="button" value="注册" />
	
</div>
</body>
</html>
